<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>
    
    <style>
      /* –ö–Ω–æ–ø–∫–∞ —Å—Ç–∞—Ä—Ç–∞ (–Ω—É–∂–Ω–∞, —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä —Ä–∞–∑—Ä–µ—à–∏–ª –∑–≤—É–∫) */
      #start-screen {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); z-index: 999; display: flex;
        justify-content: center; align-items: center; color: white;
        font-family: sans-serif; font-size: 20px; text-align: center;
      }
    </style>
  </head>
  <body>

    <div id="start-screen" onclick="startExperience()">
      <div>
        <p>–ù–∞–∂–º–∏ —Å—é–¥–∞, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —Å—é—Ä–ø—Ä–∏–∑! üéÅ</p>
        <small>(–í–∫–ª—é—á–∏ –∑–≤—É–∫)</small>
      </div>
    </div>

    <a-scene 
	  mindar-image="imageTargetSrc: ./targets.mind;" 
	  color-space="sRGB" 
	  renderer="colorManagement: true, physicallyCorrectLights: true" 
	  vr-mode-ui="enabled: false" 
	  device-orientation-permission-ui="enabled: false">

	  <a-assets>
	    <a-asset-item id="dogModel" src="./dog.glb"></a-asset-item>
	    <audio id="greetingAudio" src="./voice.mp3" preload="auto"></audio>
	  </a-assets>

	  <a-light type="ambient" intensity="1.5"></a-light>
	  <a-light type="directional" position="0 10 5" intensity="1.0"></a-light>

	  <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

	  <a-entity mindar-image-target="targetIndex: 0" id="target">
	    
	    <a-gltf-model 
	      src="#dogModel" 
	      rotation="90 0 0" 
	      position="0 0 0.1" 
	      scale="2 2 2" 
	      animation-mixer="clip: *; loop: repeat">
	    </a-gltf-model>
	    
	  </a-entity>
    </a-scene>

    <script>
      const startScreen = document.getElementById('start-screen');
      const audio = document.getElementById('greetingAudio');
      const target = document.getElementById('target');
      
      let started = false;

      // –§—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ —ç–∫—Ä–∞–Ω
      function startExperience() {
	  if (started) return;
	  started = true;
	  startScreen.style.display = 'none';
	  
	  // "–ë—É–¥–∏–º" –∞—É–¥–∏–æ –¥–≤–∏–∂–æ–∫
	  audio.play().then(() => {
	    audio.pause();
	    audio.currentTime = 0;
	  }).catch(e => console.error("–û—à–∏–±–∫–∞ –∑–≤—É–∫–∞:", e));
       }

      // –°–ª—É—à–∞–µ–º, –∫–æ–≥–¥–∞ –∫–∞–º–µ—Ä–∞ —É–≤–∏–¥–∏—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É
      target.addEventListener("targetFound", event => {
        console.log("–¶–µ–ª—å –Ω–∞–π–¥–µ–Ω–∞");
        audio.play();
      });

      // (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ü–∞—É–∑–∞, –µ—Å–ª–∏ –ø–æ—Ç–µ—Ä—è–ª–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É –∏–∑ –≤–∏–¥—É
      target.addEventListener("targetLost", event => {
        console.log("–¶–µ–ª—å –ø–æ—Ç–µ—Ä—è–Ω–∞");
        audio.pause();
        audio.currentTime = 0; // –ò–ª–∏ —É–±—Ä–∞—Ç—å —ç—Ç—É —Å—Ç—Ä–æ–∫—É, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏–ª–æ —Å —Ç–æ–≥–æ –∂–µ –º–µ—Å—Ç–∞
      });
    </script>
  </body>
</html>
